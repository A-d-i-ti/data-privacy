import hashlib
import requests

def check_password_pwned(password):
    # 1. Hash the password using SHA-1
    sha1 = hashlib.sha1(password.encode()).hexdigest().upper()

    # First 5 chars of hash (prefix)
    prefix = sha1[:5]

    # Remaining part of the hash (suffix)
    suffix = sha1[5:]

    # 2. Query the HIBP API with the prefix only
    url = "https://api.pwnedpasswords.com/range/" + prefix
    response = requests.get(url)

    # 3. Check if suffix is in the API response
    hashes = (line.split(':') for line in response.text.splitlines())

    for h, count in hashes:
        if h == suffix:
            return int(count)   # Number of times leaked

    return 0  # Not found â†’ Not leaked


# ---------------- MAIN PROGRAM ----------------
file_name = input("Enter filename (with usernames & passwords): ")

with open(file_name, "r") as file:
    for line in file:
        username, password = line.strip().split(",")

        count = check_password_pwned(password)

        if count > 0:
            print(f"Password for user '{username}' has been leaked {count} times!")
        else:
            print(f"Password for user '{username}' is safe (not found in breaches).")
